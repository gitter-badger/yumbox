(function(){var e,t,o;o=window.sys,e=window.sys.modules.auth,t=function(t,o,r,n,s,a){var c,i,u,l;return l=n.$default({currentUser:null}),c=function(o){return l.currentUser=o,t.$broadcast(e.events.loggedIn,l.currentUser),t.$broadcast(e.events.sessionStarted,l.currentUser)},i=function(t,n){var s;return s=o.defer(),r.post(e.endpoints.login,{email:t,password:n}).then(function(e){return e instanceof Error?s.reject("Wrong email or password. Please try again."):(c(e.data.data),s.resolve(l.currentUser)),s.promise},function(e){switch(e.status){case 0:s.reject("Cannot connect to server. Please try again later.");break;case 400:s.reject("Please enter both email and password.");break;case 401:s.reject("Wrong email or password. Please try again.")}return s.promise})},u={login:i,logged:c,session:function(){return r.get(e.endpoints.session,{cache:!1}).then(function(o){var r;return t.logged_in=!0,o.data.data.success?(l.currentUser=o.data.data,t.$broadcast(e.events.sessionStarted,l.currentUser)):(console.log("No session"),r=[e.states.forgot.config.url,e.states.register.config.url],r.indexOf(a.path())>-1?void 0:(t.logged_in=!1,console.log("yoooooooooooooooooooo"),s.go("login")))})},logout:function(){return r.post(e.endpoints.logout).then(function(){return l.currentUser=null,t.$broadcast(e.events.loggedOut),s.go(e.states.login.name)})},getCurrentUser:function(){return l.currentUser}}},t.$inject=["$rootScope","$q","$http","$sessionStorage","$state","$location"],angular.module(e.name).factory(e.services.authentication,t)}).call(this);