(function(){var e,n;n=window.sys.modules.settings,e=function(e,t,a,o,r){var s;return s={assign:function(){return e.hostel={},e.countries={Australia:"Australia","New Zealand":"New Zealand","United Kingdom":"United Kingdom"},e.cities={Sydney:"Sydney",Melbourne:"Melbourne"}},load:function(){return a.get(n.endpoints.profile).success(function(n){return e.hostel=n.data,e.avatar="/cdn/hostel/"+e.hostel.doc_key+"/mavatar.jpg"})},clear:function(){return jsonMask(e.hostel,"name,address,description,location/*,interests,country,city,phone,reception_name")},events:{assign:function(){return e.remove=s.events.remove,e.$on("mapInitialized",s.events.map),e.is_main=s.events.is_main,e.set_as_main=s.events.set_as_main,e.update=s.events.update},update:function(){return a.put(n.endpoints.profile,s.clear(e.hostel)).success(function(n){return console.log(n),e.hostel=n.data}).error(function(n,t){return 400===t?e.error=n.message.split("[")[1].slice(0,-1):void 0})},remove:function(t){return a["delete"](n.endpoints.images.remove.replace(":name",e.hostel.images[t])).then(function(n){return e.hostel.images.splice(t,1)})},map:function(n,t){var a,r,s;return r=t,a=function(){var n;return n=new google.maps.Geocoder,n.geocode({address:e.hostel.address},function(n,t){var a;return t===google.maps.GeocoderStatus.OK?(a=n[0].geometry.location,r.setCenter(a),r.markers[0].setPosition(a),r.panTo(a),e.hostel.location={latitude:a.lat(),longitude:a.lng()}):void 0})},s=null,e.$watch("hostel.address",function(){return o.cancel(s),s=o(function(){return a()},2e3)}),e.mark=function(n){return e.hostel.location={latitude:n.latLng.lat(),longitude:n.latLng.lng()},r.panTo(n.latLng)}},is_main:function(e){return null!==e.match(/main/)},set_as_main:function(t){return a.post(n.endpoints.images.main.replace(":name",e.hostel.images[t])).then(function(n){return n.data.data=s.fix_cache(n.data.data),e.hostel.images=n.data.data})}},uploader:function(){var t,a;return a=e.uploader=new r({autoUpload:!0,alias:"images[0]",url:n.endpoints.images.add}),a.onSuccessItem=function(n,t,a,o){return t.data=s.fix_cache(t.data),e.hostel.images=t.data},t=e.avatar_uploader=new r({autoUpload:!0,alias:"avatar",url:n.endpoints.avatar}),t.onSuccessItem=function(n,t,a,o){return e.avatar=e.avatar+"?"+moment()}},fix_cache:function(e){var n,t,a,o;if(null==e)return[];for(n=a=0,o=e.length;o>a;n=++a)if(t=e[n],/main/.test(t))return e[n]=t+"?"+moment(),e;return e}},s.assign(),s.events.assign(),s.uploader(),s.load()},e.$inject=n.controllers.profile.inject,angular.module(n.name).controller(n.controllers.profile.name,e)}).call(this);